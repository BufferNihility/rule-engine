# scala-rules
Scala-Rules is a forward chaining rule engine, built in [Scala](https://www.scala-lang.org). The engine comes with a DSL with which derivations can be modelled as small steps that combine into large derived networks of facts.

The project started with a Dutch DSL to facilitate bankers writing mortgage-related calculations. An English translation of the DSL is still in progress.

[![Codeship Status for scala-rules/scala-rules](https://codeship.com/projects/628dece0-e3e8-0133-a9e8-3aa3f222b1f1/status?branch=master)](https://codeship.com/projects/146192)

# Getting Started

The minimal requirement to get started is to add the artefact containing the rule engine to your project. Below are snippets for SBT and Maven. Be sure to check if any newer versions exist and adjust the snippet accordingly.

**SBT** - `build.sbt`
```
libraryDependencies ++= "org.scala-rules" %% "rule-engine" % "0.2.6"
```

**Maven** - `pom.xml`
```xml
<dependency>
	<groupId>org.scala-rules</groupId>
	<artifactId>rule-engine_2.11</artifactId>
	<version>0.2.6</version>
</dependency>
```

# Concepts

The rule engine uses a `Fact` as the base for all of its derivations. A `Fact` defines its name and type so it can be referenced in evaluations down the road. `Facts` are best defined inside a `Glossary`:

```scala
class MyGlossary extends Glossary {
	val factA = defineFact[Int]("factA")
	val factB = defineFact[Int]("factB")
	val factC = defineFact[Int]("factC")
}
```

*Note: the name of the fact is currently repeated as the first argument of the `defineFact` function. This string is actually used inside the engine and must be unique for all `Facts` used by the engine. We are looking for ways to remove this parameter, if you have any suggestions, let us know.*

Using this glossary, it is now possible to define derivations. The Scala Rules DSL (currently only in Dutch) provides an easy way to express how facts interact come together to form your logic. To enable the DSL, create a class that extends `Berekening`:

```scala
import org.scalarules.dsl.nl.grammar._
import MyGlossary._

class MyArithmics extends Berekening {
	Gegeven (factA > 0) Bereken factC is factB - factA 
}
```

The two listings above are actually all you need to define your calculations, validations or evaluations. The engine will have enough information to start working for you. Only one thing is still missing for the scenario to make sense to you: values.

The engine requires you to construct a `Context` mapping a set of initial `Facts` to their values. When you have that, you can let the engine do the rest:

```scala
val initialContext: Context = Context(
  factA -> 4,
  factB -> 10
)
val derivations: List[Derivation] = new MyArithmics().berekeningen

val resultContext: Context = FactEngine.runNormalDerivations(initialContext, derivations)
```

### Debugging

If you want to see exactly what the engine is doing, you can replace the `runNormalDerivations` with `runDebugDerivations`. The return type of that function is a tuple containing the resulting `Context` and a list of `Step` objects. The latter describe exactly what actions the engine performed and why:

```scala
val initialContext: Context = Context(
  factA -> 4,
  factB -> 10
)
val derivations: List[Derivation] = new MyArithmics().berekeningen

val (resultContext, steps) = FactEngine.runDebugDerivations(initialContext, derivations)

println(PrettyPrinter.printSteps(steps))
```


# Future Work

The DSL is currently only available in Dutch. We are working on translating it into English and expect this to be releasable in the next month.

In our project, we are using a utility project to visualise the dependency graphs generated by the engine. These graphs provide great insights in the execution order of the engine and allow for easy review of derivations by non-programmers. This project cannot as of yet be released as an open source module. We are working on generalising this and expect it to be releasable in the next two months. Hereâ€™s an example of what a derivation graph looks like:

![Example Dependency Graph showing Execution Order of derivations](./docs/images/example_graph.png)
